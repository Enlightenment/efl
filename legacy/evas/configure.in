AC_INIT(src/Evas.h)
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(evas, 0.0.1)
AC_PROG_CC
AM_PROG_CC_STDC
AM_WITH_DMALLOC
AC_C_CONST
AM_ENABLE_SHARED
AM_PROG_LIBTOOL
if test X"$enable_shared" = Xyes; then
  DLLDFLAGS=-export-dynamic
  AC_SUBST(DLLDFLAGS)
fi
AC_PROG_INSTALL
AC_PROG_MAKE_SET

#### Find out about X
AC_PATH_X
AC_PATH_XTRA

if test "x$x_includes" = "x"; then
  x_includes="/usr/include"
fi

x_cflags="$X_CFLAGS"
x_ldflags="$X_LDFLAGS"
x_libs="$X_LIBS $X_EXTRA_LIBS"

AC_CHECK_LIB(X11, XOpenDisplay, x_libs="$x_libs",
  AC_MSG_ERROR([ERROR: libX11 not found.]); exit,
  $X_LDFLAGS $X_EXTRA_LIBS $X_LIBS)
AC_CHECK_LIB(Xext, XShmAttach, x_libs="-lXext $x_libs",
	     AC_CHECK_LIB(XextSam, XShmAttach,
		          x_libs="-lXextSam -lXext $x_libs",
			  AC_MSG_ERROR([ERROR: XShm not found.]); exit, 
			  $x_libs),
	     $x_libs)
AC_CHECK_LIB(Xext, XShapeCombineMask, x_libs="-lXext $x_libs",
             AC_MSG_ERROR([ERROR: XShape not found.]); exit,
	     $x_libs)

AC_SUBST(x_cflags)
AC_SUBST(x_includes)
AC_SUBST(x_ldflags)
AC_SUBST(x_libs)

#### Find out about E db
#AC_CHECK_HEADER(Edb.h,
#AC_CHECK_LIB(edb, e_db_open, ,[
#echo ""
#echo "ERROR: E db needed"
#echo ""
#AC_MSG_ERROR([Fatal Error: no E db detected.]); exit], -L/usr/local/lib -ldb)
#)

#### Find out about Imlib2
AC_CHECK_HEADER(Imlib2.h,
AC_CHECK_LIB(Imlib2, imlib_context_set_image, ,[
echo ""
echo "ERROR: Imlib 2 needed"
echo ""
AC_MSG_ERROR([Fatal Error: no Imlib2 detected.]); exit], -L/usr/X11R6/lib -L/usr/local/lib -lm -ldl -lttf -lX11 -lXext)
)

AC_CHECK_LIB(ttf, TT_Init_FreeType, TTF_LIBS=-lttf, [
echo ""
echo "ERROR: Imlib 2 needs a system with libttf.so (TrueType Font Library)"
echo "You can obtain it from:"
echo "ftp://ftp.enlightenment.org/pub/enlightenment/"
echo "ftp://www.rasterman.com/pub/enlightenment/"
echo "You can also obtain it from:"
echo "http://www.freetype.org/"
echo "You can obtain some truetype fonts from:"
echo "http://voyager.cns.ohiou.edu/~sadkins/web_library/fonts/font_archive/"
echo ""
AC_MSG_ERROR([Fatal Error: no FreeType detected.])], -lm)

AC_CHECK_HEADERS(freetype.h freetype/freetype.h,[ break] , )

AC_CHECK_HEADER(freetype.h, [ ftype=yes ], [ ftype=no ])
AC_CHECK_HEADER(freetype/freetype.h, [ ftype_ftype=yes ], [ ftype_ftype=no ])

if test x$ftype = xno; then
if test x$ftype_ftype = xno; then
echo ""
echo "ERROR: freetype.h not found in freetype.h or freetype/freetype.h include"
echo "paths. (ie /usr/include, /usr/local/include etc.). You need the freetype"
echo "header files to build Imlib 2. This may mean you have to install the"
echo "freetype-devel packages for your distribution or if all else fails"
echo "find the source for freetype and install that somewhere where Imlib 2"
echo "can find the header files."
echo ""
echo "You can obtain it from:"
echo "ftp://ftp.enlightenment.org/pub/enlightenment/"
echo "ftp://www.rasterman.com/pub/enlightenment/"
echo "You can also obtain it from:"
echo "http://www.freetype.org/"
echo "You can obtain some truetype fonts from:"
echo "http://voyager.cns.ohiou.edu/~sadkins/web_library/fonts/font_archive/"
echo ""
AC_MSG_ERROR([Fatal Error: no FreeType header files detected.])
fi
fi


gl_includes=""
#### Find out about OpenGL
AC_CHECK_HEADER(GL/gl.h,
gl_includes="-I/usr/include -I/usr/local/include"
AC_CHECK_LIB(GL, glBindTexture, AC_DEFINE(HAVE_GL) ,[
AC_CHECK_HEADER($x_includes"/GL/gl.h",
gl_includes="-I/usr/include -I/usr/local/include -I/usr/X11R6/include/"
AC_CHECK_LIB(GL, glBindTexture, AC_DEFINE(HAVE_GL) ,[
echo "... no GL found"
], -L/usr/local/lib -lGL $X_LDFLAGS $X_EXTRA_LIBS $X_LIBS)
)
], -L/usr/local/lib -lGL $X_LDFLAGS $X_EXTRA_LIBS $X_LIBS)
)
#### Find out about OpenGL's GLU
AC_CHECK_HEADER(GL/glu.h,
gl_includes=$gl_includes" -I/usr/include -I/usr/local/include"
AC_CHECK_LIB(GLU, gluBuild2DMipmaps, AC_DEFINE(HAVE_GLU) ,[
AC_CHECK_HEADER($x_includes"/GL/glu.h",
gl_includes=$gl_includes" -I/usr/include -I/usr/local/include -I/usr/X11R6/include/"
AC_CHECK_LIB(GLU, gluBuild2DMipmaps, AC_DEFINE(HAVE_GLU) ,[
echo "... no GLU found"
], -L/usr/local/lib -lGL -lGLU $X_LDFLAGS $X_EXTRA_LIBS $X_LIBS)
)
], -L/usr/local/lib -lGL -lGLU $X_LDFLAGS $X_EXTRA_LIBS $X_LIBS)
)

AC_SUBST(gl_includes)

AC_OUTPUT(Makefile src/Makefile test/Makefile)
